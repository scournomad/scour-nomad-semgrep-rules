rules:
  - id: jsonwebtoken-ignore-exp
    languages: [javascript, typescript]
    message: jwt.verify configured with ignoreExpiration true accepts expired tokens.
    severity: WARNING
    patterns:
      - pattern-either:
          - pattern: |
              jwt.verify($TOK, $KEY, { ignoreExpiration: true, ... })
          - pattern: jwt.verify($TOK, $KEY, { $OPTS, ... })
    metavariable-pattern:
      OPTS:
        pattern-regex: |
          "ignoreExpiration\s*:\s*true"
    metadata:
      cwe: "CWE-522: Insufficiently Protected Credentials"
      owasp: "A07:2021-Identification and Authentication Failures"
      severity: "Medium"
      risk_score: ""
      confidence: "High"
      impact: "Accepting expired tokens weakens authentication and session controls."
      recommendation: "Do not set ignoreExpiration to true; properly handle token refresh and expiration checks."
      references:
        - https://github.com/auth0/node-jsonwebtoken#jwtverifytoken-secretorpublickey-options-callback
      tags:
        - node
        - jwt
        - jsonwebtoken
        - CWE-522
        - A07:2021
      verification:
        strategy: manual
        steps:
          - Inspect jwt.verify options for ignoreExpiration: true
        expected_outcome: Expired tokens may be accepted
        tooling:
          unit: none
          dast: none
