rules:
  - id: dom-embed-setattribute-src-data-url
    languages: [javascript, typescript]
    message: Setting <embed> src to a data: URL can execute untrusted active content.
    severity: ERROR
    patterns:
      - pattern-either:
          - pattern: $EMB.setAttribute('src', $VAL)
          - pattern: $EMB.setAttribute("src", $VAL)
      - metavariable-pattern:
          VAL:
            pattern-regex: ^\s*['\"]data:.*
    metadata:
      cwe: "CWE-829: Inclusion of Functionality from Untrusted Control Sphere"
      owasp: "A06:2021-Vulnerable and Outdated Components"
      severity: "High"
      risk_score: ""
      confidence: "High"
      impact: "data: URLs in <embed> can load active content that runs in the page context."
      recommendation: "Avoid data: URLs for <embed>; use trusted HTTPS origins and correct types."
      references:
        - https://developer.mozilla.org/docs/Web/HTML/Element/embed
      tags:
        - shared
        - dom
        - embed
        - code-exec
        - CWE-829
        - A06:2021
      verification:
        strategy: unit
        steps:
          - Detect setAttribute('src','data:...') on <embed>
        expected_outcome: Code execution vector identified
        tooling:
          unit: none
          dast: none
