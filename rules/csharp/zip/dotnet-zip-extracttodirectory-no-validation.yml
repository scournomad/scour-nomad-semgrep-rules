rules:
  - id: dotnet-zip-extracttodirectory-no-validation
    languages: [csharp]
    message: Zip Slip risk. ExtractToDirectory without validating entry paths allows traversal.
    severity: ERROR
    patterns:
      - pattern: ZipFile.ExtractToDirectory($ZIP, $DEST, ...)
    metadata:
      cwe: "CWE-22: Path Traversal"
      owasp: "A01:2021-Broken Access Control"
      severity: "High"
      risk_score: null
      confidence: "Low"
      impact: "Malicious ZIP entries can write files outside the destination directory, overwriting system or app files."
      recommendation: "Validate each entry's FullName to prevent traversal; extract to a temp dir and canonicalize paths."
      references:
        - https://snyk.io/research/zip-slip-vulnerability
      tags:
        - zip
        - CWE-22
        - A01:2021
        - WASC-33
      verification:
        strategy: unit
        steps:
          - Extract zip with entries containing '../'
        expected_outcome: Files can be written outside target dir
        tooling:
          unit: xunit
          dast: none
