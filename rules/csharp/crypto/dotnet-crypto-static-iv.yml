rules:
  - id: dotnet-crypto-static-iv
    languages: [csharp]
    message: Static IV detected. Use random IV per encryption operation.
    severity: WARNING
    patterns:
      - pattern-either:
          - pattern: $AES.IV = new byte[] { ... }
          - pattern: $AES.IV = Convert.FromBase64String("...")
    metadata:
      cwe: "CWE-329: Generation of Predictable IV with CBC Mode"
      owasp: "A02:2021-Cryptographic Failures"
      severity: "Medium"
      risk_score: ""
      confidence: "Low"
      impact: "Predictable/constant IVs enable pattern leakage and may allow attacks against CBC mode confidentiality."
      recommendation: "Generate a fresh, random IV for each encryption operation and store/transmit it alongside the ciphertext."
      references:
        - https://learn.microsoft.com/dotnet/standard/security/cryptographic-services
        - https://cheatsheetseries.owasp.org/cheatsheets/Cryptographic_Storage_Cheat_Sheet.html
      tags:
        - crypto
        - CWE-329
        - A02:2021
      cvss:
        base: ""
        vector: ""
        grade: ""
      verification:
        strategy: unit
        steps:
          - Inspect code for constant IV assignment
        expected_outcome: Static IV assignment present
        tooling:
          unit: xunit
          dast: none
