rules:
  - id: dotnet-cookies-securepolicy-none
    languages: [csharp]
    message: CookieSecurePolicy.None permits cookies over HTTP. Enforce Always in production.
    severity: WARNING
    patterns:
      - pattern-inside: |
          services.AddAuthentication(...).AddCookie(options => { $BODY })
      - pattern: options.Cookie.SecurePolicy = CookieSecurePolicy.None
    metadata:
      cwe: "CWE-614: Sensitive Cookie in HTTPS Session Without 'Secure' Attribute"
      owasp: "A07:2021-Identification and Authentication Failures"
      wasc: "WASC-04: Insufficient Transport Layer Protection"
      severity: "Medium"
      risk_score: ""
      confidence: "Medium"
      impact: "Cookies without the Secure attribute may be sent over HTTP, exposing session identifiers to interception and session hijacking."
      recommendation: "Set Cookie.SecurePolicy = CookieSecurePolicy.Always in production and ensure the application enforces HTTPS. Combine with HttpOnly and appropriate SameSite."
      references:
        - https://learn.microsoft.com/aspnet/core/security/authentication/cookie
        - https://cheatsheetseries.owasp.org/cheatsheets/Session_Management_Cheat_Sheet.html#cookie-based-session-handling
      tags:
        - cookies
        - CWE-614
        - A07:2021
        - WASC-04
      cvss:
        base: ""
        vector: ""
        grade: ""
      verification:
        strategy: manual
        steps:
          - Review prod environment; enforce HTTPS cookies
        expected_outcome: SecurePolicy set to Always
        tooling:
          unit: none
          dast: none
