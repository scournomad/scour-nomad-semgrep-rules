rules:
  - id: dotnet-authz-minimalapi-missing-requireauthorization
    languages: [csharp]
    message: Minimal API endpoint without `RequireAuthorization()` may expose endpoints unintentionally.
    severity: WARNING
    patterns:
      - pattern-either:
          - pattern: $EP.MapGet($PATH, $HANDLER)
          - pattern: $EP.MapPost($PATH, $HANDLER)
          - pattern: $EP.MapPut($PATH, $HANDLER)
          - pattern: $EP.MapDelete($PATH, $HANDLER)
          - pattern: $EP.MapPatch($PATH, $HANDLER)
      - pattern-not: $EP.MapGet($PATH, $HANDLER).RequireAuthorization(...)
      - pattern-not: $EP.MapPost($PATH, $HANDLER).RequireAuthorization(...)
      - pattern-not: $EP.MapPut($PATH, $HANDLER).RequireAuthorization(...)
      - pattern-not: $EP.MapDelete($PATH, $HANDLER).RequireAuthorization(...)
      - pattern-not: $EP.MapPatch($PATH, $HANDLER).RequireAuthorization(...)
    metadata:
      cwe: "CWE-306: Missing Authentication for Critical Function"
      owasp: "A01:2021-Broken Access Control"
      severity: "Medium"
      risk_score: ""
      confidence: "Low"
      impact: "Endpoints without RequireAuthorization() may be unintentionally exposed to unauthenticated users."
      recommendation: "Apply RequireAuthorization() to endpoints that require authentication or move them behind an authorization policy."
      references:
        - https://learn.microsoft.com/aspnet/core/security/authorization/middleware
      tags:
        - authz
        - CWE-306
        - A01:2021
        - WASC-01
      verification:
        strategy: manual
        steps:
          - Review endpoints expected to be protected
        expected_outcome: Add RequireAuthorization where intended
        tooling:
          unit: none
          dast: none
