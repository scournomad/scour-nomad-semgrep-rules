rules:
  - id: dotnet-authz-allowanonymous
    languages: [csharp]
    message: Controller/action allows anonymous access. Ensure this is intended or add [Authorize].
    severity: WARNING
    pattern-either:
      - pattern: "[AllowAnonymous]\nclass $C : Controller { ... }"
      - pattern: "[AllowAnonymous]\n$RET $ACTION(...) { ... }"
    metadata:
      cwe: "CWE-306: Missing Authentication for Critical Function"
      owasp: "A07:2021-Identification and Authentication Failures"
      confidence: medium
      references:
        - https://learn.microsoft.com/aspnet/core/security/authorization/simple
      verification:
        strategy: manual
        preconditions:
          - Endpoint under review exposes sensitive functionality
        steps:
          - Inspect controller/action annotated with [AllowAnonymous]
        expected_outcome: Confirm anonymous access is intended; otherwise flag
        tooling:
          unit: none
          dast: none
